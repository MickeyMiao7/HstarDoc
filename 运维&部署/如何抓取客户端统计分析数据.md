# 0、前言

一个强大，好用的统计分析系统，能够非常方便的将用户访问数据，站点性能数据，各种统计信息进行汇总展示。这对于有点体量的公司都是非常重要的。

# 1、客户端信息收集

## 1.1、基本信息

要收集浏览器信息，一般是通过 `navigator` 对象，从这里面，可以获取到：

```js
navigator.language // 浏览器当前语言
navigator.userAgent // 浏览器信息
navigator.platform // 操作系统平台
navigator.javaEnabled() // 是否支持Java
navigator.maxTouchPoints // 触摸点个数
```

其次，还会通过 `screen` 收集屏幕信息：

```js
screen.width // 屏幕宽度
screen.height // 屏幕高度
screen.colorDepth // 屏幕颜色bit
```

通过 `document` 获取文档相关信息

```js
document.referrer // 来源站点
```

## 1.2、性能信息

要收集性能信息，我们需要通过 `performance` 对象，其中大致分为：`Navigation Timing`, `User Timing` 以及 ` Resource Timing`。

首先，通过 ``var perfData = window.performance.timing;`` 获取到时间点数据，这些时间数据都是以long类型的UTC时间，数据大致结构如下：

```js
var perfData = {
  connectEnd:                 1511431220347, // 结束连接
  connectStart:               1511431220347, // 开始连接
  domComplete:                1511431221532, // DOM渲染完毕
  domContentLoadedEventEnd:   1511431220886,
  domContentLoadedEventStart: 1511431220884,
  domInteractive:             1511431220884,
  domLoading:                 1511431220680, // 开始DOM渲染
  domainLookupEnd:            1511431220347, // 结束DNS解析
  domainLookupStart:          1511431220347, // 开始DNS解析
  fetchStart:                 1511431220347, // 开始Fetch
  loadEventEnd:               1511431221565,
  loadEventStart:             1511431221532,
  navigationStart:            1511431220272, // 开始导航
  redirectEnd:                0,             // 结束跳转
  redirectStart:              0,             // 开始跳转
  requestStart:               1511431220353, // 开始请求
  responseEnd:                1511431220680, // 结束响应
  responseStart:              1511431220678, // 开始响应
  secureConnectionStart:      0,             // 开始安全连接
  unloadEventEnd:             0,
  unloadEventStart:           0
}
```

以此，我们可以得出如下时间数据：

```js
var dnsLookupTime = perfData.domainLookupEnd - perfData.domainLookupStart; // DNS解析耗时
var tcpConnectTime = perfData.connectEnd - perfData.connectEnd; // TCP连接耗时
var pageLoadTime = perfData.loadEventEnd - perfData.navigationStart; // 页面加载时间，对应 Network 的 Load
var connectTime = perfData.responseEnd - perfData.requestStart; // 开始请求到结束响应的时间
var renderTime = perfData.domComplete - perfData.domLoading; // 页面渲染所用的时间
var domContentLoadedTime = perfData.domContentLoadedEventEnd - perfData.navigationStart;// 页面内容加载时间，对应 Network 的 DOMContentLoaded
var onloadTime = perfData.loadEventEnd - perfData.navigationStart; // 页面加载时间
var resolveDomTreeTime = perfData.domComplete = perfData.domInteractive; // 解析DOM树耗时

```

# 2、异常信息收集


